{"version":3,"file":"create-container.js","sources":["src/component-container.js","src/create-container.js"],"sourcesContent":["import { h, customElement, useEffect, useRef } from \"atomico\";\r\n\r\nfunction getRoot(current) {\r\n  return current.shadowRoot || current;\r\n}\r\n\r\nfunction Container({ options, props }) {\r\n  let ref = useRef();\r\n  let { sandbox } = props;\r\n\r\n  useEffect(() => {\r\n    let { current } = ref;\r\n\r\n    if (sandbox) {\r\n      let { contentDocument, contentWindow } = current;\r\n\r\n      if (!ref.load) {\r\n        let script = document.createElement(\"script\");\r\n        let style = document.createElement(\"style\");\r\n\r\n        style.textContent = `html,body{margin:0px;width:100%;height:100%;overflow:auto}`;\r\n        /**\r\n         * HACK, the use of code split, improves the micro frontend experience,\r\n         * since it allows to assimilate the execution of the application in a\r\n         * sandbox, this leaves the task of synchronizing with history\r\n         */\r\n        script.textContent = `window.$ =(${options.source})().then(md=>md.default)`;\r\n\r\n        contentDocument.head.appendChild(script);\r\n        contentDocument.head.appendChild(style);\r\n\r\n        Object.defineProperty(contentWindow, \"history\", {\r\n          value: history\r\n        });\r\n\r\n        ref.load = true;\r\n      }\r\n\r\n      contentWindow.$.then(component => {\r\n        options.render(contentDocument.body, component, props);\r\n      });\r\n    } else {\r\n      options\r\n        .source()\r\n        .then(component =>\r\n          options.render(getRoot(current), component.default, props)\r\n        );\r\n    }\r\n  }, [props]);\r\n\r\n  useEffect(() => {\r\n    let { current } = ref;\r\n    if (sandbox) {\r\n      let { contentDocument } = current;\r\n      return () => options.render(contentDocument.body, null, null);\r\n    } else {\r\n      return () => options.render(getRoot(current), null, null);\r\n    }\r\n  }, []);\r\n\r\n  return sandbox ? (\r\n    <host>\r\n      <iframe\r\n        ref={ref}\r\n        width=\"100%\"\r\n        height=\"100%\"\r\n        sandbox=\"allow-same-origin allow-scripts allow-popups allow-forms allow-top-navigation\"\r\n        frameborder=\"0\"\r\n      ></iframe>\r\n    </host>\r\n  ) : (\r\n    <host ref={ref} shadowDom={props.shadowDom}></host>\r\n  );\r\n}\r\n\r\nContainer.props = {\r\n  options: Object,\r\n  props: Object\r\n};\r\n\r\nexport default customElement(\"a-microfrontend-container\", Container);\r\n","import { h } from \"atomico\";\r\nimport ComponentContainer from \"./component-container\";\r\n\r\nexport default function createContainer(source, render) {\r\n  return props => (\r\n    <ComponentContainer\r\n      options={{ source, render }}\r\n      props={props}\r\n    ></ComponentContainer>\r\n  );\r\n}\r\n"],"names":["getRoot","current","shadowRoot","Container","options","props","ref","useRef","sandbox","useEffect","contentDocument","contentWindow","load","script","document","createElement","style","textContent","source","head","appendChild","Object","defineProperty","value","history","$","then","component","render","body","default","shadowDom","customElement","createContainer"],"mappings":";;AAEA,SAASA,OAAT,CAAiBC,OAAjB,EAA0B;SACjBA,OAAO,CAACC,UAAR,IAAsBD,OAA7B;;;AAGF,SAASE,SAAT,CAAmB;EAAEC,OAAF;EAAWC;CAA9B,EAAuC;MACjCC,GAAG,GAAGC,MAAM,EAAhB;MACI;IAAEC;MAAYH,KAAlB;EAEAI,SAAS,CAAC,MAAM;QACV;MAAER;QAAYK,GAAlB;;QAEIE,OAAJ,EAAa;UACP;QAAEE,eAAF;QAAmBC;UAAkBV,OAAzC;;UAEI,CAACK,GAAG,CAACM,IAAT,EAAe;YACTC,MAAM,GAAGC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAb;YACIC,KAAK,GAAGF,QAAQ,CAACC,aAAT,CAAuB,OAAvB,CAAZ;QAEAC,KAAK,CAACC,WAAN,GAAqB,4DAArB;;;;;;;QAMAJ,MAAM,CAACI,WAAP,GAAsB,cAAab,OAAO,CAACc,MAAO,0BAAlD;QAEAR,eAAe,CAACS,IAAhB,CAAqBC,WAArB,CAAiCP,MAAjC;QACAH,eAAe,CAACS,IAAhB,CAAqBC,WAArB,CAAiCJ,KAAjC;QAEAK,MAAM,CAACC,cAAP,CAAsBX,aAAtB,EAAqC,SAArC,EAAgD;UAC9CY,KAAK,EAAEC;SADT;QAIAlB,GAAG,CAACM,IAAJ,GAAW,IAAX;;;MAGFD,aAAa,CAACc,CAAd,CAAgBC,IAAhB,CAAqBC,SAAS,IAAI;QAChCvB,OAAO,CAACwB,MAAR,CAAelB,eAAe,CAACmB,IAA/B,EAAqCF,SAArC,EAAgDtB,KAAhD;OADF;KAzBF,MA4BO;MACLD,OAAO,CACJc,MADH,GAEGQ,IAFH,CAEQC,SAAS,IACbvB,OAAO,CAACwB,MAAR,CAAe5B,OAAO,CAACC,OAAD,CAAtB,EAAiC0B,SAAS,CAACG,OAA3C,EAAoDzB,KAApD,CAHJ;;GAhCK,EAsCN,CAACA,KAAD,CAtCM,CAAT;EAwCAI,SAAS,CAAC,MAAM;QACV;MAAER;QAAYK,GAAlB;;QACIE,OAAJ,EAAa;UACP;QAAEE;UAAoBT,OAA1B;aACO,MAAMG,OAAO,CAACwB,MAAR,CAAelB,eAAe,CAACmB,IAA/B,EAAqC,IAArC,EAA2C,IAA3C,CAAb;KAFF,MAGO;aACE,MAAMzB,OAAO,CAACwB,MAAR,CAAe5B,OAAO,CAACC,OAAD,CAAtB,EAAiC,IAAjC,EAAuC,IAAvC,CAAb;;GANK,EAQN,EARM,CAAT;SAUOO,OAAO,GACZ,gBACE;IACE,GAAG,EAAEF,GADP;IAEE,KAAK,EAAC,MAFR;IAGE,MAAM,EAAC,MAHT;IAIE,OAAO,EAAC,+EAJV;IAKE,WAAW,EAAC;IANhB,CADY,GAWZ;IAAM,GAAG,EAAEA,GAAX;IAAgB,SAAS,EAAED,KAAK,CAAC0B;IAXnC;;;AAeF5B,SAAS,CAACE,KAAV,GAAkB;EAChBD,OAAO,EAAEiB,MADO;EAEhBhB,KAAK,EAAEgB;CAFT;AAKA,yBAAeW,aAAa,CAAC,2BAAD,EAA8B7B,SAA9B,CAA5B;;AC7Ee,SAAS8B,eAAT,CAAyBf,MAAzB,EAAiCU,MAAjC,EAAyC;SAC/CvB,KAAK,IACV,EAAC,kBAAD;IACE,OAAO,EAAE;MAAEa,MAAF;MAAUU;KADrB;IAEE,KAAK,EAAEvB;IAHX;;;;;"}