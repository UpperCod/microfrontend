{"version":3,"file":"microfrontend.js","sources":["src/component-container.js","src/container.js","src/component-sandbox.js","src/sandbox.js","src/preact.js","src/react.js","src/vue.js"],"sourcesContent":["import { h, customElement, useEffect, useHost } from \"atomico\";\r\n\r\nfunction getRoot(current) {\r\n  return current.shadowRoot || current;\r\n}\r\n\r\nfunction Container({ options, props }) {\r\n  let ref = useHost();\r\n\r\n  useEffect(() => {\r\n    let { current } = ref;\r\n    options\r\n      .source()\r\n      .then(component =>\r\n        options.render(getRoot(current), component.default || component, props)\r\n      );\r\n  }, [props]);\r\n\r\n  useEffect(() => {\r\n    let { current } = ref;\r\n    return () => options.render(getRoot(current), null, null);\r\n  }, []);\r\n  return <host shadowDom={props.shadowDom}></host>;\r\n}\r\n\r\nContainer.props = {\r\n  options: Object,\r\n  props: Object\r\n};\r\n\r\nexport default customElement(\"a-microfrontend-container\", Container);\r\n","import { h } from \"atomico\";\r\nimport ComponentContainer from \"./component-container\";\r\n\r\nexport function Container(source, render) {\r\n  return props => (\r\n    <ComponentContainer\r\n      options={{ source, render }}\r\n      props={props}\r\n    ></ComponentContainer>\r\n  );\r\n}\r\n","import { h, customElement, useEffect, useHost } from \"atomico\";\r\n\r\nfunction SandBox({ options, props }) {\r\n  let ref = useHost();\r\n\r\n  useEffect(() => {\r\n    let { contentDocument, contentWindow } = ref.current;\r\n\r\n    if (!ref.load) {\r\n      let script = document.createElement(\"script\");\r\n      let style = document.createElement(\"style\");\r\n\r\n      style.textContent = `html,body{margin:0px;width:100%;height:100%;overflow:auto}`;\r\n      /**\r\n       * HACK, the use of code split, improves the micro frontend experience,\r\n       * since it allows to assimilate the execution of the application in a\r\n       * sandbox, this leaves the task of synchronizing with history\r\n       */\r\n      script.textContent = `window.$ =(${options.source})().then(md=>md.default)`;\r\n\r\n      contentDocument.head.appendChild(script);\r\n      contentDocument.head.appendChild(style);\r\n\r\n      Object.defineProperty(contentWindow, \"history\", {\r\n        value: history\r\n      });\r\n\r\n      ref.load = true;\r\n    }\r\n\r\n    contentWindow.$.then(component => {\r\n      options.render(contentDocument.body, component, props);\r\n    });\r\n  }, [props]);\r\n\r\n  useEffect(() => {\r\n    let { contentDocument } = ref.current;\r\n    return () => options.render(contentDocument.body, null, null);\r\n  }, []);\r\n\r\n  return (\r\n    <host\r\n      width=\"100%\"\r\n      height=\"100%\"\r\n      sandbox=\"allow-same-origin allow-scripts allow-popups allow-forms allow-top-navigation\"\r\n      frameBorder=\"0\"\r\n    ></host>\r\n  );\r\n}\r\n\r\nSandBox.props = {\r\n  options: Object,\r\n  props: Object\r\n};\r\n\r\nexport default customElement(\"a-microfrontend-sandbox\", SandBox, {\r\n  base: HTMLIFrameElement,\r\n  extends: \"iframe\"\r\n});\r\n","import { h } from \"atomico\";\r\nimport ComponentSandbox from \"./component-sandbox\";\r\n\r\nexport function Sandbox(source, render) {\r\n  return props => (\r\n    <ComponentSandbox\r\n      options={{ source, render }}\r\n      props={props}\r\n    ></ComponentSandbox>\r\n  );\r\n}\r\n","import { h, render } from \"preact\";\r\n\r\nexport function preact(node, component, props) {\r\n  render(props ? h(component, props) : null, node, node);\r\n}\r\n","import { createElement } from \"react\";\r\nimport { render } from \"react-dom\";\r\n\r\nexport function react(node, component, props) {\r\n  render(props ? createElement(component, props) : null, node);\r\n}\r\n","import Vue from \"vue\";\r\n\r\nlet refVue = Symbol(\"vue\");\r\n\r\nexport function vue(node, component, props) {\r\n  if (!node[refVue]) {\r\n    node[refVue] = new Vue({\r\n      data: props,\r\n      render: h => h(component)\r\n    });\r\n  } else if (props) {\r\n    node[refVue].data = props;\r\n  } else {\r\n    node[refVue].$destroy();\r\n  }\r\n}\r\n"],"names":["getRoot","current","shadowRoot","Container","options","props","ref","useHost","useEffect","source","then","component","render","default","shadowDom","Object","customElement","SandBox","contentDocument","contentWindow","load","script","document","createElement","style","textContent","head","appendChild","defineProperty","value","history","$","body","base","HTMLIFrameElement","extends","Sandbox","preact","node","h","react","refVue","Symbol","vue","Vue","data","$destroy"],"mappings":";;;;;;AAEA,SAASA,OAAT,CAAiBC,OAAjB,EAA0B;SACjBA,OAAO,CAACC,UAAR,IAAsBD,OAA7B;;;AAGF,SAASE,SAAT,CAAmB;EAAEC,OAAF;EAAWC;CAA9B,EAAuC;MACjCC,GAAG,GAAGC,OAAO,EAAjB;EAEAC,SAAS,CAAC,MAAM;QACV;MAAEP;QAAYK,GAAlB;IACAF,OAAO,CACJK,MADH,GAEGC,IAFH,CAEQC,SAAS,IACbP,OAAO,CAACQ,MAAR,CAAeZ,OAAO,CAACC,OAAD,CAAtB,EAAiCU,SAAS,CAACE,OAAV,IAAqBF,SAAtD,EAAiEN,KAAjE,CAHJ;GAFO,EAON,CAACA,KAAD,CAPM,CAAT;EASAG,SAAS,CAAC,MAAM;QACV;MAAEP;QAAYK,GAAlB;WACO,MAAMF,OAAO,CAACQ,MAAR,CAAeZ,OAAO,CAACC,OAAD,CAAtB,EAAiC,IAAjC,EAAuC,IAAvC,CAAb;GAFO,EAGN,EAHM,CAAT;SAIO;IAAM,SAAS,EAAEI,KAAK,CAACS;IAA9B;;;AAGFX,SAAS,CAACE,KAAV,GAAkB;EAChBD,OAAO,EAAEW,MADO;EAEhBV,KAAK,EAAEU;CAFT;AAKA,yBAAeC,aAAa,CAAC,2BAAD,EAA8Bb,SAA9B,CAA5B;;AC3BO,SAASA,WAAT,CAAmBM,MAAnB,EAA2BG,MAA3B,EAAmC;SACjCP,KAAK,IACV,EAAC,kBAAD;IACE,OAAO,EAAE;MAAEI,MAAF;MAAUG;KADrB;IAEE,KAAK,EAAEP;IAHX;;;ACFF,SAASY,OAAT,CAAiB;EAAEb,OAAF;EAAWC;CAA5B,EAAqC;MAC/BC,GAAG,GAAGC,OAAO,EAAjB;EAEAC,SAAS,CAAC,MAAM;QACV;MAAEU,eAAF;MAAmBC;QAAkBb,GAAG,CAACL,OAA7C;;QAEI,CAACK,GAAG,CAACc,IAAT,EAAe;UACTC,MAAM,GAAGC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAb;UACIC,KAAK,GAAGF,QAAQ,CAACC,aAAT,CAAuB,OAAvB,CAAZ;MAEAC,KAAK,CAACC,WAAN;;;;;;;MAMAJ,MAAM,CAACI,WAAP,wBAAmCrB,OAAO,CAACK,MAA3C;MAEAS,eAAe,CAACQ,IAAhB,CAAqBC,WAArB,CAAiCN,MAAjC;MACAH,eAAe,CAACQ,IAAhB,CAAqBC,WAArB,CAAiCH,KAAjC;MAEAT,MAAM,CAACa,cAAP,CAAsBT,aAAtB,EAAqC,SAArC,EAAgD;QAC9CU,KAAK,EAAEC;OADT;MAIAxB,GAAG,CAACc,IAAJ,GAAW,IAAX;;;IAGFD,aAAa,CAACY,CAAd,CAAgBrB,IAAhB,CAAqBC,SAAS,IAAI;MAChCP,OAAO,CAACQ,MAAR,CAAeM,eAAe,CAACc,IAA/B,EAAqCrB,SAArC,EAAgDN,KAAhD;KADF;GAzBO,EA4BN,CAACA,KAAD,CA5BM,CAAT;EA8BAG,SAAS,CAAC,MAAM;QACV;MAAEU;QAAoBZ,GAAG,CAACL,OAA9B;WACO,MAAMG,OAAO,CAACQ,MAAR,CAAeM,eAAe,CAACc,IAA/B,EAAqC,IAArC,EAA2C,IAA3C,CAAb;GAFO,EAGN,EAHM,CAAT;SAME;IACE,KAAK,EAAC,MADR;IAEE,MAAM,EAAC,MAFT;IAGE,OAAO,EAAC,+EAHV;IAIE,WAAW,EAAC;IALhB;;;AAUFf,OAAO,CAACZ,KAAR,GAAgB;EACdD,OAAO,EAAEW,MADK;EAEdV,KAAK,EAAEU;CAFT;AAKA,uBAAeC,aAAa,CAAC,yBAAD,EAA4BC,OAA5B,EAAqC;EAC/DgB,IAAI,EAAEC,iBADyD;EAE/DC,OAAO,EAAE;CAFiB,CAA5B;;ACpDO,SAASC,OAAT,CAAiB3B,MAAjB,EAAyBG,MAAzB,EAAiC;SAC/BP,KAAK,IACV,EAAC,gBAAD;IACE,OAAO,EAAE;MAAEI,MAAF;MAAUG;KADrB;IAEE,KAAK,EAAEP;IAHX;;;ACFK,SAASgC,MAAT,CAAgBC,IAAhB,EAAsB3B,SAAtB,EAAiCN,KAAjC,EAAwC;EAC7CO,MAAM,CAACP,KAAK,GAAGkC,GAAC,CAAC5B,SAAD,EAAYN,KAAZ,CAAJ,GAAyB,IAA/B,EAAqCiC,IAArC,EAA2CA,IAA3C,CAAN;;;ACAK,SAASE,KAAT,CAAeF,IAAf,EAAqB3B,SAArB,EAAgCN,KAAhC,EAAuC;EAC5CO,QAAM,CAACP,KAAK,GAAGkB,aAAa,CAACZ,SAAD,EAAYN,KAAZ,CAAhB,GAAqC,IAA3C,EAAiDiC,IAAjD,CAAN;;;ACFF,IAAIG,MAAM,GAAGC,MAAM,CAAC,KAAD,CAAnB;AAEA,AAAO,SAASC,GAAT,CAAaL,IAAb,EAAmB3B,SAAnB,EAA8BN,KAA9B,EAAqC;MACtC,CAACiC,IAAI,CAACG,MAAD,CAAT,EAAmB;IACjBH,IAAI,CAACG,MAAD,CAAJ,GAAe,IAAIG,GAAJ,CAAQ;MACrBC,IAAI,EAAExC,KADe;MAErBO,MAAM,EAAE2B,CAAC,IAAIA,CAAC,CAAC5B,SAAD;KAFD,CAAf;GADF,MAKO,IAAIN,KAAJ,EAAW;IAChBiC,IAAI,CAACG,MAAD,CAAJ,CAAaI,IAAb,GAAoBxC,KAApB;GADK,MAEA;IACLiC,IAAI,CAACG,MAAD,CAAJ,CAAaK,QAAb;;;;;;"}